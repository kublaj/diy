"use strict";

var rewire = require("rewire");



var x = 0
var y = 0

var injectTestDeps = (mod) => {

    mod.__set__('uid', () => {
        x = x + 1;
        return x
    })

    mod.__set__('moment', () => {
            return {
                format: () => {
                    return ""
                }
            }
        })
}


var file    = rewire(`../file`)
injectTestDeps(file)

var tree    = rewire(`../tree`)
injectTestDeps(tree)

var webPack = rewire(`../packs/web`)
injectTestDeps(webPack)

var make    = rewire(`../backends/make`)
injectTestDeps(make)



var {
    transcript
} = make
var {
    parse
} = tree

var f = parse(_ => {
    _.addPack(webPack)
    _.collect("all", _ => {
        _.mirrorTo("./lib", {
            strip: 'src/'
        }, _ => {
            _.collect("build", _ => {
                _.minify(_ => {
                    _.livescript("src/*.ls", "src/packs/*.ls", "src/backends/*.ls")
                    _.sixToFive("src/*.js6")
                })

            })
        })

        _.toFile("./index.js", _ => {
            _.minify(_ => {
                _.livescript("src/index.ls")
            })
        })
    })
})

transcript(f);
