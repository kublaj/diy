"use strict";

var rewire = require("rewire");

var tree           = rewire(`../tree.js`)
var webPack        = rewire(`../packs/web`)
var make           = rewire(`../backends/make`)

var x = 0
var y = 0

tree.__set__('uid', () => {
    x = x + 1;
    return x
})

webPack.__set__('uid', () => {
    y = y + 1;
    return y 
})

make.__set__('moment', () => {
    return {
        format: () => {
            return "NEVER"
        }
    }
})


var { transcript } = make
var { parse } = tree

var f = parse(_ => {
    _.addPack(webPack)
    _.collect("all", _ => {
            _.mirrorTo("./lib", {
                strip: 'src/'
            }, _ => {
                        _.collect("build", _ => {
                            _.minify(_ => {
                                _.livescript("src/*.ls")
                                _.livescript("src/packs/*.ls")
                                _.livescript("src/backends/*.ls")
                                _.sixToFive("src/*.js6")
                            })

                        })
                    })

            _.toFile("./index.js", _ => {
                _.minify(_ => {
                    _.livescript("src/index.ls")
                })
            })
    })
})

transcript(f);

